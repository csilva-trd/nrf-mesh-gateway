# General Config
CONFIG_NEWLIB_LIBC=y
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y   # Needed for cJSON number handling.
CONFIG_ASSERT=y
CONFIG_REBOOT=y
CONFIG_FW_INFO=y

# Fatal error
CONFIG_RESET_ON_FATAL_ERROR=n
CONFIG_WATCHDOG=n

# Heap and stacks
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_MAIN_STACK_SIZE=8192
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
CONFIG_APPLICATION_WORKQUEUE_STACK_SIZE=1024
CONFIG_SHELL_STACK_SIZE=2048
CONFIG_HW_STACK_PROTECTION=y

# Settings Config
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y
CONFIG_SETTINGS=y
CONFIG_FCB=y
CONFIG_SETTINGS_FCB=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# Force GPS_SIM off to save 2KB of RAM:
CONFIG_GPS_USE_EXTERNAL=y
CONFIG_GPS_USE_SIM=n
CONFIG_GPS_SIM=n

# Network Config
CONFIG_NETWORKING=y
CONFIG_NET_NATIVE=n
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_OFFLOAD=y

# LTE Config
CONFIG_POWER_OPTIMIZATION_ENABLE=n
CONFIG_LTE_LINK_CONTROL=y
CONFIG_LTE_NETWORK_MODE_LTE_M_GPS=n
CONFIG_LTE_AUTO_INIT_AND_CONNECT=n
CONFIG_LTE_NETWORK_MODE_NBIOT=n
CONFIG_LTE_PSM_REQ_RPTAU="00000110"
CONFIG_LTE_PSM_REQ_RAT="00000010"
CONFIG_LTE_LOCK_BANDS=y
CONFIG_LTE_LOCK_BAND_MASK="1000000010000001100010001110"  # Enable band 2, 3, 4, 8, 12, 13, 20 and 28
CONFIG_LTE_CONNECT_RETRY_DELAY=10

# Modem Info Config
CONFIG_MODEM_INFO=y
CONFIG_MODEM_INFO_ADD_DATE_TIME=n
CONFIG_MODEM_INFO_ADD_SIM_ICCID=n
CONFIG_NRF_MODEM_LIB=y
CONFIG_NRF_MODEM_LIB_TRACE_ENABLED=n

# AT Modem Libs
CONFIG_AT_CMD=y
CONFIG_AT_CMD_THREAD_STACK_SIZE=1024
CONFIG_AT_HOST_LIBRARY=n # AT command uart bridge for modem

# nRF Cloud Config
CONFIG_CLOUD_API=y
CONFIG_NRF_CLOUD_MQTT=y
CONFIG_NRF_CLOUD_CONNECTION_POLL_THREAD=y
CONFIG_CJSON_LIB=y  # Needed for the cloud codec
# Shorter to prevent NAT timeouts
CONFIG_MQTT_KEEPALIVE=120
# Don't resubscribe to topics if broker remembers them
CONFIG_MQTT_CLEAN_SESSION=n
# Set maximum recievable payload size
CONFIG_NRF_CLOUD_MQTT=y
CONFIG_NRF_CLOUD_MQTT_PAYLOAD_BUFFER_LEN=2048

CONFIG_NRF_CLOUD_SEND_NONBLOCKING=n
# use our nrf_socket.h workaround instead of bsdlib fix
CONFIG_NRF91_SOCKET_SEND_SPLIT_LARGE_BLOCKS=n
CONFIG_CLOUD_CONNECT_RETRY_DELAY=10
CONFIG_NRF_CLOUD_CLIENT_ID_SRC_RUNTIME=n

# Switch to new certs and device ID method
CONFIG_NRF_CLOUD_CLIENT_ID_SRC_INTERNAL_UUID=y
CONFIG_MODEM_JWT=y
CONFIG_NRF_CLOUD_SEC_TAG=42

# MCU Boot
#CONFIG_BOOTLOADER_MCUBOOT=y
#CONFIG_IMG_MANAGER=y
#CONFIG_MCUBOOT_IMG_MANAGER=y
#CONFIG_IMG_ERASE_PROGRESSIVELY=y
##CONFIG_SECURE_BOOT=y
##CONFIG_BUILD_S1_VARIANT=y

# Date Time Lib
CONFIG_DATE_TIME=y
CONFIG_DATE_TIME_MODEM=n
CONFIG_DATE_TIME_NTP=y
CONFIG_DATE_TIME_LOG_LEVEL_DBG=y

# Console
CONFIG_CONSOLE_SUBSYS=n
CONFIG_CONSOLE_HANDLER=n
CONFIG_CONSOLE_GETCHAR=n

# Bluetooth HCI Config
CONFIG_BT_H4=y
CONFIG_BT_HCI=y
CONFIG_BT_WAIT_NOP=y
CONFIG_BT_HCI_MESH_EXT=y
CONFIG_BT_TINYCRYPT_ECC=y
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_NRFX_TIMER2=y

# Bluetooth Config
CONFIG_BT=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_BROADCASTER=y
CONFIG_BT_SETTINGS=y
CONFIG_BT_LL_SW_SPLIT=y

# Disable Unused Bluetooth Features
CONFIG_BT_CTLR_LE_ENC=n
CONFIG_BT_DATA_LEN_UPDATE=n
CONFIG_BT_PHY_UPDATE=n
CONFIG_BT_CTLR_CHAN_SEL_2=n
CONFIG_BT_CTLR_MIN_USED_CHAN=n
CONFIG_BT_CTLR_PRIVACY=n

# Mesh Config
CONFIG_BT_MESH=y
CONFIG_BT_MESH_TX_SEG_MSG_COUNT=3
CONFIG_BT_MESH_RX_SEG_MSG_COUNT=3
CONFIG_BT_MESH_TX_SEG_MAX=10
CONFIG_BT_MESH_RX_SEG_MAX=10
CONFIG_BT_MESH_ADV_BUF_COUNT=10
CONFIG_BT_MESH_RPL_STORE_TIMEOUT=600
CONFIG_BT_MESH_ACCESS_LAYER_MSG=y # Used for gateway direct access to model messages and access layer.

# Mesh Provisioner Config
CONFIG_BT_MESH_PROVISIONER=y
CONFIG_BT_MESH_PROV_DEVICE=n
CONFIG_BT_MESH_PB_ADV=y
#CONFIG_BT_MESH_PB_GATT=y

# Mesh Node Config
CONFIG_BT_MESH_CFG_CLI=y
CONFIG_BT_MESH_HEALTH_CLI=y
CONFIG_BT_MESH_SUBNET_COUNT=5
CONFIG_BT_MESH_APP_KEY_COUNT=5
CONFIG_BT_MESH_MODEL_GROUP_COUNT=5
CONFIG_BT_MESH_GATEWAY_SUB_LIST_LEN=20

# Mesh Feature Config
CONFIG_BT_MESH_BEACON_ENABLED=n
#CONFIG_BT_MESH_RELAY=y
#CONFIG_BT_MESH_FRIEND=y
#CONFIG_BT_MESH_GATT_PROXY=y

# Mesh CDB Config
CONFIG_BT_MESH_CDB=y
CONFIG_BT_MESH_CDB_NODE_COUNT=10
CONFIG_BT_MESH_CDB_APP_KEY_COUNT=5
CONFIG_BT_MESH_CDB_SUBNET_COUNT=5

# Shell Config
CONFIG_SHELL=y
CONFIG_SHELL_ARGC_MAX=14
CONFIG_SHELL_WILDCARD=n
#CONFIG_INIT_STACKS=y
#CONFIG_THREAD_STACK_INFO=y
#CONFIG_KERNEL_SHELL=y
#CONFIG_THREAD_MONITOR=y
CONFIG_BOOT_BANNER=n
#CONFIG_THREAD_NAME=y
#CONFIG_DEVICE_SHELL=y
CONFIG_POSIX_CLOCK=y
#CONFIG_DATE_SHELL=y
CONFIG_SHELL_PROMPT_UART="meshgw:# "

# App Shell Config
CONFIG_SHELL_MESH_HEALTH=y
CONFIG_SHELL_MESH_HEARTBEAT=y
CONFIG_SHELL_MESH_SIG=y
CONFIG_SHELL_MESH_VND=y
CONFIG_SHELL_MESH_MSG=y

# Logging Config
CONFIG_LOG=y
#CONFIG_NET_LOG=y
CONFIG_NRF_CLOUD_MESH_GATEWAY_LOG_LEVEL_DBG=y
#CONFIG_LTE_LINK_CONTROL_LOG_LEVEL_DBG=y
CONFIG_NRF_CLOUD_LOG_LEVEL_DBG=y
CONFIG_NET_LOG=n
CONFIG_MQTT_LOG_LEVEL_INF=n
CONFIG_LOG_MODE_IMMEDIATE=n
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_FUNC_NAME_PREFIX_INF=y
CONFIG_LOG_FUNC_NAME_PREFIX_ERR=y
CONFIG_LOG_PRINTK=y
CONFIG_LOG_STRDUP_BUF_COUNT=128
CONFIG_LOG_STRDUP_MAX_STRING=128

# Debug Config
CONFIG_PRINTK=y
CONFIG_BT_DEBUG_LOG=y
CONFIG_BT_DEBUG_CONN=y
CONFIG_BT_DEBUG_GATT=y
CONFIG_BT_DEBUG_HCI_CORE=n
CONFIG_BT_DEBUG_HCI_DRIVER=n

CONFIG_BT_MESH_DEBUG=y
#CONFIG_BT_MESH_DEBUG_ACCESS=y
#CONFIG_BT_MESH_DEBUG_TRANS=y # CAUSES HARD FAULTS ON SOME DBG PRINT
#CONFIG_BT_MESH_DEBUG_KEYS=y
#CONFIG_BT_MESH_DEBUG_CDB=y
#CONFIG_BT_MESH_DEBUG_CRYPTO=y
#CONFIG_BT_MESH_DEBUG_MODEL=y
#CONFIG_BT_MESH_DEBUG_SETTINGS=y
#CONFIG_BT_MESH_DEBUG_ADV=y
#CONFIG_BT_MESH_DEBUG_PROV=y
#CONFIG_BT_MESH_DEBUG_BEACON=y
#CONFIG_BT_MESH_DEBUG_NET=y
